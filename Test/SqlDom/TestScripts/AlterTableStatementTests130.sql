-- Turns the system versioning off.
--
ALTER TABLE T SET (SYSTEM_VERSIONING = OFF);
GO

-- Adds sytem time period.
--
ALTER TABLE T 
ADD PERIOD FOR SYSTEM_TIME (SYS_START, SYS_END);
GO

-- Turns the system versioning on.
--
ALTER TABLE T SET (SYSTEM_VERSIONING = ON(HISTORY_TABLE=T_HST));
GO

-- Turns the system versioning on and explicitly use data consistency check.
--
ALTER TABLE T SET (SYSTEM_VERSIONING = ON(HISTORY_TABLE=T_HST, DATA_CONSISTENCY_CHECK=ON));
GO


-- Turns the system versioning on with default history table.
--
ALTER TABLE T SET (SYSTEM_VERSIONING = ON);
GO

-- Turns the system versioning on and avoids data consistency check.
--
ALTER TABLE T SET (SYSTEM_VERSIONING = ON(HISTORY_TABLE=T_HST, DATA_CONSISTENCY_CHECK=OFF));
GO

-- Adds system time period and period's columns.
--
ALTER TABLE T ADD
SYS_START DATETIME2(7) GENERATED ALWAYS AS ROW START NOT NULL,
SYS_END   DATETIME2(7) GENERATED ALWAYS AS ROW END NOT NULL,
PERIOD FOR SYSTEM_TIME (SYS_START, SYS_END);
GO

-- Drops  period.
--
ALTER TABLE T 
DROP PERIOD FOR SYSTEM_TIME;
GO

-- Adds system time period and columns that are not included into it
-- in one ALTER TABLE call.
--
ALTER TABLE T ADD
COL_A DATETIME2(7),
COL_B DATETIME2(7),
COL_C INT,
PERIOD FOR SYSTEM_TIME (SYS_START, SYS_END);
GO

-- Adds generated always as UserID start column
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START NOT NULL;
GO

-- Adds generated always as UserID start column without NOT NULL
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START;
GO

-- Adds generated always as UserID end column
ALTER TABLE T ADD
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END NOT NULL;
GO

-- Adds generated always as UserName start column
ALTER TABLE T ADD
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START NOT NULL;
GO

-- Adds generated always as UserName end column
ALTER TABLE T ADD
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END NOT NULL;
GO

-- Adds all four generated always as UserId and UserName columns
--
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START NOT NULL,
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END NOT NULL,
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START NOT NULL,
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END NOT NULL;
GO

-- Adds all four generated always as UserId and UserName columns without NOT NULL
--
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START,
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END,
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START,
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END;
GO

-- Adds all four generated always as UserId and UserName columns as hidden
--
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START HIDDEN NOT NULL,
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END HIDDEN NOT NULL,
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START HIDDEN NOT NULL,
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END HIDDEN NOT NULL;
GO

-- Adds generated always as UserId and UserName columns together
-- with system time period and period's columns
--
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START NOT NULL,
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END NOT NULL,
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START NOT NULL,
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END NOT NULL,
SYS_START DATETIME2(7) GENERATED ALWAYS AS ROW START NOT NULL,
SYS_END   DATETIME2(7) GENERATED ALWAYS AS ROW END NOT NULL,
PERIOD FOR SYSTEM_TIME (SYS_START, SYS_END);
GO

-- Adds generated always as UserId and UserName columns together
-- with system time period
--
ALTER TABLE T ADD
COL_USER_ID_START VARBINARY(85) GENERATED ALWAYS AS SUSER_SID START NOT NULL,
COL_USER_ID_END VARBINARY(85) GENERATED ALWAYS AS SUSER_SID END NOT NULL,
COL_USER_NAME_START NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME START NOT NULL,
COL_USER_NAME_END NVARCHAR(128) GENERATED ALWAYS AS SUSER_SNAME END NOT NULL,
PERIOD FOR SYSTEM_TIME (SYS_START, SYS_END);
GO


GO
ALTER TABLE T MERGE RANGE ('2004-01-01');


GO
ALTER TABLE T SPLIT RANGE ('2004-01-01');


GO
ALTER TABLE T SPLIT RANGE (10);


GO
ALTER TABLE T MERGE RANGE (10);


GO
ALTER TABLE T MERGE RANGE (NULL);



